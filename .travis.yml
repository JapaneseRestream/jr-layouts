language: minimal
services:
  - docker

env:
  global:
    - DOCKER_IMAGE_NAME: japaneserestream/jr-layouts
    - DOCKER_IMAGE_NAME_TAG: $DOCKER_IMAGE_NAME:$TRAVIS_BUILD_ID

before_script:
  - make docker-login

script:
  - make docker-build

after_success:
  - wget https://raw.githubusercontent.com/DiscordHooks/travis-ci-discord-webhook/master/send.sh
  - chmod +x send.sh
  - ./send.sh success $WEBHOOK_URL

after_failure:
  - wget https://raw.githubusercontent.com/DiscordHooks/travis-ci-discord-webhook/master/send.sh
  - chmod +x send.sh
  - ./send.sh failure $WEBHOOK_URL

deploy:
  # Push with branch name
  - provider: script
    script: make docker-push-branch
    on:
      all_branches: true
  # Test purpose
  - provider: script
    script: echo start && sleep 60 && echo done
    on:
      all_branches: true
  # Push latest tag
  - provider: script
    script: make docker-push-latest
    on:
      branch: master
