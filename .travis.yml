language: minimal
services:
  - docker

before_script:
  - make docker-login

script:
  - make docker-build

after_success:
  - make discord-notify-success

after_failure:
  - make discord-notify-failure

before_deploy:
  - eval "$(ssh-agent -s)"

deploy:
  - provider: script
    script: make docker-push-branch
    on:
      all_branches: true
  - provider: script
    script: make docker-push-latest
    on:
      branch: master
  - provider: script
    script: make deploy-staging
    on:
      branch: master
