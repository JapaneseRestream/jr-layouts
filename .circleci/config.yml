version: 2

jobs:
  build:
    machine: true
    branches:
      only:
        - master
    steps:
      - run:
          name: Deploy
          command: |
            ssh -o "StrictHostKeyChecking no" $SSH_USER@$SSH_HOST " \
              export NVM_DIR=~/.nvm && \
              source ~/.nvm/nvm.sh && \
              cd ~/nodecg/bundles/jr-layouts && \
              git pull && \
              npm i && \
              make && \
              cd ~/nodecg && \
              pm2 restart 0
            "
